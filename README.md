# Cat Time Bot

## Описание

Cat Time Bot - это Telegram-бот, который автоматически отправляет изображения котов пользователям каждый день в 9:00 по московскому времени. Бот построен на базе библиотеки aiogram и использует The Cat API для получения изображений котов. Проект включает функционал для пользователей и администраторов, с базой данных для хранения информации о пользователях.

## Функции

- **Ежедневная рассылка котов**: Автоматическая отправка изображений котов в назначенное время.
- **Пользовательский интерфейс**: Команды для подписки, отписки и получения котов по запросу.
- **Админ-панель**: Администраторы могут управлять рассылкой, просматривать статистику и взаимодействовать с пользователями.
- **Логирование**: Подробное логирование всех действий бота.
- **База данных**: Хранение данных пользователей в SQLite.

## Технологии

- **Язык программирования**: Python 3.8+
- **Фреймворк**: aiogram 3.4.1
- **База данных**: SQLite с использованием aiosqlite
- **Планировщик задач**: APScheduler
- **API для котов**: The Cat API
- **Другие зависимости**:
  - python-dotenv: Для работы с переменными окружения
  - aiohttp: Для асинхронных HTTP-запросов

## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone <url репозитория>
cd cat_time
```

### 2. Создание виртуального окружения

```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта и заполните следующие переменные:

```
BOT_TOKEN=ваш_токен_от_BotFather
CAT_API_KEY=ваш_ключ_от_TheCatAPI
DATABASE_NAME=cat_bot.db
ADMIN_IDS=ваш_telegram_id,другой_admin_id
```

- `BOT_TOKEN`: Токен вашего бота от @BotFather в Telegram.
- `CAT_API_KEY`: Ключ API от [The Cat API](https://thecatapi.com/). Зарегистрируйтесь для получения ключа.
- `DATABASE_NAME`: Имя файла базы данных (по умолчанию `cat_bot.db`).
- `ADMIN_IDS`: Telegram ID администраторов, разделенные запятыми. Получить свой ID можно через бота @userinfobot.

### 5. Запуск бота

```bash
python bot.py
```

Бот запустится и начнет работать. При успешном запуске администратор получит уведомление в Telegram.

## Структура проекта

```
cat_time/
├── bot.py                 # Главный файл запуска бота
├── requirements.txt       # Зависимости проекта
├── Dockerfile             # Docker-конфигурация
├── docker-compose.yml     # Docker Compose файл
├── .env                   # Переменные окружения (не коммитить)
├── config/
│   └── settings.py        # Настройки и конфигурация
├── bot/
│   └── core.py            # Создание бота и диспетчера
├── database/
│   ├── connection.py      # Подключение к БД
│   ├── models.py          # Модели базы данных
│   └── users.py           # Операции с пользователями
├── users/
│   ├── handlers.py        # Обработчики для пользователей
│   ├── keyboards.py       # Клавиатуры для пользователей
│   └── models.py          # Модели пользователей
├── admin/
│   ├── handlers.py        # Обработчики для администраторов
│   ├── keyboards.py       # Клавиатуры для администраторов
│   ├── models.py          # Модели администраторов
│   └── filters.py         # Фильтры для админов
├── services/
│   ├── cat_api.py         # Интеграция с The Cat API
│   └── scheduler.py       # Планировщик рассылок
└── utils/
    ├── common.py          # Общие утилиты
    └── logger.py          # Настройка логирования
```

## Команды пользователя

- `/start` - Запуск бота и подписка на ежедневную рассылку котов
- `/stop` - Отписка от рассылки
- `/cat` - Получить изображение кота прямо сейчас
- `/help` - Справка по командам

## Админ-команды

Администраторы имеют доступ к дополнительным функциям через специальную панель.

## Развертывание

### Docker

Проект поставляется с Docker-конфигурацией для легкого развертывания.

1. Убедитесь, что у вас установлен Docker и Docker Compose.

2. Заполните `.env` файл как описано выше.

3. Запустите:

```bash
docker-compose up -d
```

### Производственное развертывание

Для производства рекомендуется:
- Использовать более надежную базу данных (PostgreSQL)
- Настроить логирование в файлы или внешние сервисы
- Использовать webhook вместо polling для Telegram API
- Настроить мониторинг и алерты

## Разработка

### Добавление новых функций

1. Создайте новый модуль в соответствующей директории (`users/`, `admin/`, `services/`)
2. Реализуйте логику в обработчиках
3. Регистрируйте новые роутеры в `bot.py`


## Контакты

1221jumper@gmail.com